<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RamOn Systems — IT Fixes & How‑Tos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Practical IT articles: fixes, troubleshooting, and how‑tos." />

  <!-- Make all relative URLs resolve under /Site/ -->
  <base href="/Site/">

  <!-- Assets -->
  <link rel="stylesheet" href="assets/styles.css" />
  <link rel="icon" href="data:,">
</head>
<body>
  <!-- Seasonal effects layer + toggle -->
  <div id="seasonal-layer" class="seasonal" aria-hidden="true"></div>
  <a id="seasonal-toggle" class="seasonal" href="#" title="Toggle seasonal effects">✨ Effects: On</a>

  <!-- HEADER -->
  <header class="site-header">
    <div class="container header-grid">
      <a class="brand" href="./">RamOn <span class="brand-accent">Systems</span></a>
      <nav class="top-nav">
        <a href="./">Home</a>
        <a href="post.html?slug=about">About</a>
        <button id="themeToggle" class="btn ghost" aria-label="Toggle dark mode">☾</button>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <section class="hero">
      <h1>IT Issues, Solved.</h1>
      <p class="sub">Straightforward guides, fixes, and notes from the trenches.</p>

      <div class="controls">
        <input id="searchInput" type="search" placeholder="Search posts (e.g., 'printer', 'DNS', 'Windows 11')" aria-label="Search posts" />
        <div id="tags" class="tags"></div>
      </div>
    </section>

    <section id="postsList" class="posts-list" aria-live="polite"></section>
    <div id="emptyState" class="empty hidden">No posts match your search.</div>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p>© <span id="year"></span> RamOn Systems. Built with HTML, CSS, and vanilla JS.</p>
    </div>
  </footer>

  <!-- SCRIPT -->
  <script>
    /* =====================================================
       VERSION (cache-busting)
    ===================================================== */
    const VERSION = 'v1.0.0';

    /* =====================================================
       THEME TOGGLE + ANIMATED BUTTON
    ===================================================== */
    const themeToggle = document.getElementById('themeToggle');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theme');

    if (savedTheme) document.documentElement.dataset.theme = savedTheme;
    else if (prefersDark) document.documentElement.dataset.theme = 'dark';

    themeToggle.addEventListener('click', () => {
      const next = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
      document.documentElement.dataset.theme = next;
      localStorage.setItem('theme', next);

      /* Play bounce animation */
      themeToggle.classList.remove('is-toggling');
      themeToggle.offsetHeight; 
      themeToggle.classList.add('is-toggling');
    });

    document.getElementById('year').textContent = new Date().getFullYear();

    /* =====================================================
       LOAD POSTS
    ===================================================== */
    const postsUrl = `assets/posts.json?${VERSION}`;
    const postsListEl = document.getElementById('postsList');
    const emptyStateEl = document.getElementById('emptyState');
    const tagsEl = document.getElementById('tags');
    const searchInput = document.getElementById('searchInput');

    let ALL_POSTS = [];
    let activeTag = null;
    let query = '';

    function postCard(p) {
      return `
        <article class="card">
          <div class="card-body">
            <div class="card-meta">
              <time datetime="${p.date}">${new Date(p.date).toLocaleDateString()}</time>
              ${p.tags.map(t => `<a href="#" class="tag" data-tag="${t}">${t}</a>`).join('')}
            </div>
            <h2 class="card-title"><a href="post.html?slug=${encodeURIComponent(p.slug)}">${p.title}</a></h2>
            <p class="card-excerpt">${p.excerpt}</p>
            <div class="card-actions">
              <a class="btn" href="post.html?slug=${encodeURIComponent(p.slug)}">Read</a>
            </div>
          </div>
        </article>
      `;
    }

    function renderTags(posts) {
      const set = new Set();
      posts.forEach(p => p.tags.forEach(t => set.add(t)));
      const sorted = Array.from(set).sort((a,b) => a.localeCompare(b));

      tagsEl.innerHTML =
        `<a href="#" class="tag ${!activeTag ? 'active' : ''}" data-tag="">All</a>` +
        sorted.map(t => `<a href="#" class="tag ${activeTag===t?'active':''}" data-tag="${t}">${t}</a>`).join('');
    }

    function filterPosts() {
      let list = [...ALL_POSTS];
      if (activeTag) list = list.filter(p => p.tags.includes(activeTag));
      if (query.trim()) {
        const q = query.toLowerCase();
        list = list.filter(p =>
          p.title.toLowerCase().includes(q) ||
          p.excerpt.toLowerCase().includes(q) ||
          (p.keywords || '').toLowerCase().includes(q)
        );
      }

      postsListEl.innerHTML = list.map(postCard).join('');

      /* Trigger fade + stagger animation */
      postsListEl.classList.add('is-ready');

      emptyStateEl.classList.toggle('hidden', list.length > 0);
    }

    tagsEl.addEventListener('click', (e) => {
      const tag = e.target.closest('[data-tag]');
      if (!tag) return;
      activeTag = tag.dataset.tag || null;
      renderTags(ALL_POSTS);
      filterPosts();
      e.preventDefault();
    });

    searchInput.addEventListener('input', (e) => {
      query = e.target.value;
      filterPosts();
    });

    async function init() {
      try {
        const res = await fetch(postsUrl, { cache: 'no-cache' });
        ALL_POSTS = await res.json();
        ALL_POSTS.sort((a,b) => new Date(b.date) - new Date(a.date));
        renderTags(ALL_POSTS);
        filterPosts();
      } catch (err) {
        postsListEl.innerHTML = `<p class="error">Could not load posts. Check <code>assets/posts.json</code>.</p>`;
        console.error(err);
      }
    }
    init();

    /* =====================================================
       OPTIONAL: PAGE EXIT ANIMATION
    ===================================================== */
    document.addEventListener('click', (e) => {
      const a = e.target.closest('a[href]');
      if (!a) return;

      const url = new URL(a.href, location.href);
      if (url.origin === location.origin) {
        document.body.classList.add('is-exiting');
      }
    });

    /* =====================================================
       #3 — SEASONAL EFFECTS GENERATOR (auto by month + toggle)
       (snow now includes Feb & Mar)
    ===================================================== */
    (function seasonalEffects(){
      const layer = document.getElementById('seasonal-layer');
      const toggle = document.getElementById('seasonal-toggle');
      if (!layer || !toggle) return;

      // Respect reduced motion
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // User setting
      const KEY = 'seasonalEffects';
      let enabled = localStorage.getItem(KEY);
      if (enabled === null) enabled = 'on'; // default on
      const setEnabled = (on) => {
        enabled = on ? 'on' : 'off';
        localStorage.setItem(KEY, enabled);
        toggle.textContent = (enabled === 'on') ? '✨ Effects: On' : '✨ Effects: Off';
      };
      setEnabled(enabled === 'on');

      // Toggle
      toggle.addEventListener('click', (e) => {
        e.preventDefault();
        const nowOn = enabled !== 'on';
        setEnabled(nowOn);
        if (!nowOn) layer.innerHTML = '';
        if (nowOn) renderForMonth(new Date());
      });

      // Month → effect (❄️ now includes Feb & Mar)
      function getSeasonFromDate(d) {
        const m = d.getMonth(); // 0..11
        if (m === 11 || m === 0 || m === 1 || m === 2) return 'snow';       // Dec–Mar
        if (m === 9  || m === 10)                      return 'leaves';     // Oct–Nov
        if (m >= 5 && m <= 7)                           return 'fireflies'; // Jun–Aug
        return 'none';
      }

      // Special days for confetti (month/day). Customize!
      const SPECIAL = [
        { m: 1, d: 1 },  // Feb 1 (example)
        { m: 5, d: 1 },  // Jun 1
        { m: 7, d: 1 }   // Aug 1
      ];
      function isSpecialDay(d) {
        return SPECIAL.some(s => s.m === (d.getMonth()+1) && s.d === d.getDate());
      }

      // Renderers
      function renderSnow() {
        const count = 60;
        const frag = document.createDocumentFragment();
        for (let i=0;i<count;i++){
          const el = document.createElement('div');
          el.className = 'snowflake';
          el.style.left = Math.random()*100 + 'vw';
          el.style.setProperty('--x', (Math.random()*100) + 'vw');
          el.style.setProperty('--drift', (Math.random()*60 - 30) + 'px');
          el.style.setProperty('--fall', (8 + Math.random()*7) + 's');
          el.style.setProperty('--delay', (Math.random()*8) + 's');
          frag.appendChild(el);
        }
        layer.appendChild(frag);
      }

      function renderLeaves() {
        const count = 28;
        const frag = document.createDocumentFragment();
        for (let i=0;i<count;i++){
          const el = document.createElement('div');
          el.className = 'leaf';
          el.style.left = Math.random()*100 + 'vw';
          el.style.setProperty('--x', (Math.random()*100) + 'vw');
          el.style.setProperty('--fall', (10 + Math.random()*6) + 's');
          el.style.setProperty('--delay', (Math.random()*6) + 's');
          frag.appendChild(el);
        }
        layer.appendChild(frag);
      }

      function renderFireflies() {
        const container = document.createElement('div');
        container.id = 'fireflies';
        const count = 20;
        for (let i=0;i<count;i++){
          const ff = document.createElement('div');
          ff.className = 'firefly';
          ff.style.left = Math.random()*100 + 'vw';
          ff.style.top  = Math.random()*100 + 'vh';
          ff.style.setProperty('--x0', '0px');
          ff.style.setProperty('--y0', '0px');
          ff.style.setProperty('--x1', (Math.random()*80 - 40) + 'px');
          ff.style.setProperty('--y1', (Math.random()*120 - 60) + 'px');
          ff.style.setProperty('--x2', (Math.random()*60 - 30) + 'px');
          ff.style.setProperty('--y2', (Math.random()*100 - 50) + 'px');
          ff.style.setProperty('--fly', (10 + Math.random()*6) + 's');
          ff.style.setProperty('--delay', (Math.random()*3) + 's');
          container.appendChild(ff);
        }
        layer.appendChild(container);
      }

      function burstConfetti() {
        const n = 60;
        const colors = ['#16a34a','#2563eb','#f59e0b','#ef4444','#a855f7','#22d3ee'];
        for (let i=0;i<n;i++){
          const c = document.createElement('div');
          c.className = 'confetti';
          c.style.background = colors[i % colors.length];
          const startX = (window.innerWidth/2) + (Math.random()*40 - 20);
          const startY = 60; // near top
          c.style.left = startX + 'px';
          c.style.top  = startY + 'px';

          const xEnd = startX + (Math.random()*400 - 200);
          c.style.setProperty('--x', '0px');
          c.style.setProperty('--y', '0px');
          c.style.setProperty('--xEnd', (xEnd - startX) + 'px');
          c.style.setProperty('--fall', (600 + Math.random()*500) + 'ms');
          layer.appendChild(c);

          setTimeout(()=> c.remove(), 1200);
        }
      }

      function renderForMonth(date) {
        layer.innerHTML = '';
        if (prefersReduced || enabled !== 'on') return;

        const season = getSeasonFromDate(date);
        if (season === 'snow')        renderSnow();
        else if (season === 'leaves') renderLeaves();
        else if (season === 'fireflies') renderFireflies();

        if (isSpecialDay(date)) {
          setTimeout(burstConfetti, 250);
        }
      }

      // If Jun–Aug, repaint around evening/morning boundaries (18:00/06:00)
      function maybeNightRepaint() {
        const now = new Date();
        const isSummer = now.getMonth() >= 5 && now.getMonth() <= 7;
        const hour = now.getHours();
        if (isSummer && (hour === 18 || hour === 6)) {
          renderForMonth(now);
        }
      }

      // Initial paint + interval check
      renderForMonth(new Date());
      setInterval(maybeNightRepaint, 60 * 60 * 1000);
    })();
  </script>
</body>
</html>
